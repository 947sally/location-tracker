<!DOCTYPE html>
<html>
<head>
  <title>nRF9160 定位展示</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map { height: 500px; width: 100%; }
  </style>
</head>
<body>
  <h1>nRF9160 实时定位</h1>
  <div id="map"></div>
  <p>经纬度：<span id="latlon">--</span> | 最后更新：<span id="time">--</span></p>

  <script>
    const map = L.map('map').setView([39.9042, 116.4074], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let marker;

    function updateLocation() {
      fetch('/get-location')
        .then(r => r.json())
        .then(data => {
          if (data.lat && data.lon) {
            if (marker) map.removeLayer(marker);
            marker = L.marker([data.lat, data.lon]).addTo(map);
            map.setView([data.lat, data.lon], 15);
            document.getElementById('latlon').textContent = `${data.lat}, ${data.lon}`;
            document.getElementById('time').textContent = new Date(data.time).toLocaleString();
          }
        });
    }

    setInterval(updateLocation, 3000);
    updateLocation();
  </script>
</body>
</html>
